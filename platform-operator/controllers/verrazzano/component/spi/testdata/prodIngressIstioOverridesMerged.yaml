# Copyright (c) 2021, 2022, Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.
metadata:
  name: "prod-ingress-istio-override"
spec:
  profile: "prod"
  environmentName: prodenv
  components:
    applicationOperator:
      enabled: true
    authProxy:
      enabled: true
      kubernetes:
        replicas: 2
        affinity:
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 100
                podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                      - key: app
                        operator: In
                        values:
                          - verrazzano-authproxy
                  topologyKey: kubernetes.io/hostname
    certManager:
      enabled: true
      certificate:
        ca:
          secretName: "verrazzano-ca-certificate-secret"
          clusterResourceNamespace: "cert-manager"
    coherenceOperator:
      enabled: true
    console:
      enabled: true
      overrides:
        - values:
            replicas: 2
            affinity:
              podAntiAffinity:
                preferredDuringSchedulingIgnoredDuringExecution:
                  - podAffinityTerm:
                      labelSelector:
                        matchLabels:
                          app: verrazzano-console
                      topologyKey: failure-domain.beta.kubernetes.io/zone
                    weight: 100
    dns:
      wildcard:
        domain: "nip.io"
    elasticsearch:
      enabled: true
      installArgs:
        - name: nodes.master.replicas
          value: "3"
        - name: nodes.master.requests.memory
          value: "1.4Gi"
        - name: nodes.ingest.replicas
          value: "1"
        - name: nodes.ingest.requests.memory
          value: "2.5Gi"
        - name: nodes.data.replicas
          value: "3"
        - name: nodes.data.requests.memory
          value: "4.8Gi"
        - name: nodes.data.requests.storage
          value: "50Gi"
        - name: nodes.master.requests.storage
          value: "50Gi"
    fluentd:
      enabled: true
      elasticsearchURL: "http://verrazzano-authproxy-elasticsearch:8775"
      elasticsearchSecret: verrazzano-es-internal
    grafana:
      enabled: true
    ingress:
      enabled: true
      type: LoadBalancer
      nginxInstallArgs:
        - name: controller.service.annotations."service\.beta\.kubernetes\.io/oci-load-balancer-shape"
          value: "10Mbps"
        - name: controller.service.externalTrafficPolicy
          value: Local
        - name: controller.autoscaling.enabled
          value: "true"
        - name: controller.autoscaling.minReplicas
          value: "3"
        - name: controller.service.externalIPs
          valueList:
            - 11.22.33.44
      ports:
        - name: http
          nodePort: 30080
          port: 80
          protocol: TCP
          targetPort: 0
        - name: https
          nodePort: 30443
          port: 443
          protocol: TCP
          targetPort: 0
    istio:
      enabled: true
      istioInstallArgs:
        - name: gateways.istio-ingressgateway.serviceAnnotations."service\.beta\.kubernetes\.io/oci-load-balancer-shape"
          value: "10Mbps"
        - name: gateways.istio-ingressgateway.replicaCount
          value: "3"
        - name: gateways.istio-ingressgateway.externalIPs
          valueList:
            - 11.22.33.44
      ingress:
        kubernetes:
          replicas: 2
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 100
                  podAffinityTerm:
                    labelSelector:
                      matchExpressions:
                        - key: app
                          operator: In
                          values:
                            - istio-ingressgateway
                    topologyKey: kubernetes.io/hostname
      egress:
        kubernetes:
          replicas: 2
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
                - weight: 100
                  podAffinityTerm:
                    labelSelector:
                      matchExpressions:
                        - key: app
                          operator: In
                          values:
                            - istio-egressgateway
                    topologyKey: kubernetes.io/hostname
    kiali:
      enabled: true
    keycloak:
      enabled: true
    kibana:
      enabled: true
    oam:
      enabled: true
    prometheus:
      enabled: true
    prometheusOperator:
      enabled: true
      prometheusSpec:
        storageSpec:
          volumeClaimTemplate:
            spec:
              storageClassName:
                resources:
                  requests:
                    storage: "50Gi"
                    memory: "128Mi"
    rancher:
      enabled: true
    verrazzano:
      enabled: true
    weblogicOperator:
      enabled: true

# Copyright (c) 2021, Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.

==== START logs for container istio-init of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
Environment:
------------
ENVOY_PORT=
INBOUND_CAPTURE_PORT=
ISTIO_INBOUND_INTERCEPTION_MODE=
ISTIO_INBOUND_TPROXY_MARK=
ISTIO_INBOUND_TPROXY_ROUTE_TABLE=
ISTIO_INBOUND_PORTS=
ISTIO_OUTBOUND_PORTS=
ISTIO_LOCAL_EXCLUDE_PORTS=
ISTIO_SERVICE_CIDR=
ISTIO_SERVICE_EXCLUDE_CIDR=

Variables:
----------
PROXY_PORT=15001
PROXY_INBOUND_CAPTURE_PORT=15006
PROXY_TUNNEL_PORT=15008
PROXY_UID=1337
PROXY_GID=1337
INBOUND_INTERCEPTION_MODE=REDIRECT
INBOUND_TPROXY_MARK=1337
INBOUND_TPROXY_ROUTE_TABLE=133
INBOUND_PORTS_INCLUDE=*
INBOUND_PORTS_EXCLUDE=15090,15021,15020
OUTBOUND_IP_RANGES_INCLUDE=*
OUTBOUND_IP_RANGES_EXCLUDE=
OUTBOUND_PORTS_INCLUDE=
OUTBOUND_PORTS_EXCLUDE=
KUBEVIRT_INTERFACES=
ENABLE_INBOUND_IPV6=false

Writing following contents to rules file:  /tmp/iptables-rules-1615834927333905066.txt141461451
* nat
-N ISTIO_INBOUND
-N ISTIO_REDIRECT
-N ISTIO_IN_REDIRECT
-N ISTIO_OUTPUT
-A ISTIO_INBOUND -p tcp --dport 15008 -j RETURN
-A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001
-A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006
-A PREROUTING -p tcp -j ISTIO_INBOUND
-A ISTIO_INBOUND -p tcp --dport 22 -j RETURN
-A ISTIO_INBOUND -p tcp --dport 15090 -j RETURN
-A ISTIO_INBOUND -p tcp --dport 15021 -j RETURN
-A ISTIO_INBOUND -p tcp --dport 15020 -j RETURN
-A ISTIO_INBOUND -p tcp -j ISTIO_IN_REDIRECT
-A OUTPUT -p tcp -j ISTIO_OUTPUT
-A ISTIO_OUTPUT -o lo -s REDACTED-IP4-ADDRESS/32 -j RETURN
-A ISTIO_OUTPUT -o lo ! -d REDACTED-IP4-ADDRESS/32 -m owner --uid-owner 1337 -j ISTIO_IN_REDIRECT
-A ISTIO_OUTPUT -o lo -m owner ! --uid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -m owner --uid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -o lo ! -d REDACTED-IP4-ADDRESS/32 -m owner --gid-owner 1337 -j ISTIO_IN_REDIRECT
-A ISTIO_OUTPUT -o lo -m owner ! --gid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -m owner --gid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -d REDACTED-IP4-ADDRESS/32 -j RETURN
-A ISTIO_OUTPUT -j ISTIO_REDIRECT
COMMIT

iptables-restore --noflush /tmp/iptables-rules-1615834927333905066.txt141461451
Writing following contents to rules file:  /tmp/ip6tables-rules-1615834927357435162.txt891629230

ip6tables-restore --noflush /tmp/ip6tables-rules-1615834927357435162.txt891629230
iptables-save
# Generated by iptables-save v1.8.4 on Mon Mar 15 19:02:07 2021
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:ISTIO_INBOUND - [0:0]
:ISTIO_REDIRECT - [0:0]
:ISTIO_IN_REDIRECT - [0:0]
:ISTIO_OUTPUT - [0:0]
-A PREROUTING -p tcp -j ISTIO_INBOUND
-A OUTPUT -p tcp -j ISTIO_OUTPUT
-A ISTIO_INBOUND -p tcp -m tcp --dport 15008 -j RETURN
-A ISTIO_INBOUND -p tcp -m tcp --dport 22 -j RETURN
-A ISTIO_INBOUND -p tcp -m tcp --dport 15090 -j RETURN
-A ISTIO_INBOUND -p tcp -m tcp --dport 15021 -j RETURN
-A ISTIO_INBOUND -p tcp -m tcp --dport 15020 -j RETURN
-A ISTIO_INBOUND -p tcp -j ISTIO_IN_REDIRECT
-A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001
-A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006
-A ISTIO_OUTPUT -s REDACTED-IP4-ADDRESS/32 -o lo -j RETURN
-A ISTIO_OUTPUT ! -d REDACTED-IP4-ADDRESS/32 -o lo -m owner --uid-owner 1337 -j ISTIO_IN_REDIRECT
-A ISTIO_OUTPUT -o lo -m owner ! --uid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -m owner --uid-owner 1337 -j RETURN
-A ISTIO_OUTPUT ! -d REDACTED-IP4-ADDRESS/32 -o lo -m owner --gid-owner 1337 -j ISTIO_IN_REDIRECT
-A ISTIO_OUTPUT -o lo -m owner ! --gid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -m owner --gid-owner 1337 -j RETURN
-A ISTIO_OUTPUT -d REDACTED-IP4-ADDRESS/32 -j RETURN
-A ISTIO_OUTPUT -j ISTIO_REDIRECT
COMMIT
# Completed on Mon Mar 15 19:02:07 2021
==== END logs for container istio-init of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
==== START logs for container bobbys-helidon-stock-application of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
2021.03.15 19:02:15 INFO org.jboss.weld.Version !thread!: WELD-000900: 3.1.1 (Final)
2021.03.15 19:02:16 INFO org.jboss.weld.Bootstrap !thread!: WELD-ENV-000020: Using jandex for bean discovery
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.jboss.weld.util.bytecode.ClassFileUtils$1 (file:/app/libs/weld-core-impl-3.1.1.Final.jar) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int)
WARNING: Please consider reporting this to the maintainers of org.jboss.weld.util.bytecode.ClassFileUtils$1
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
2021.03.15 19:02:16 INFO org.jboss.weld.Bootstrap !thread!: WELD-000101: Transactional services not available. Injection of @Inject UserTransaction not available. Transactional observers will be invoked synchronously.
2021.03.15 19:02:17 INFO org.jboss.weld.Event !thread!: WELD-000411: Observer method [BackedAnnotatedMethod] private io.helidon.microprofile.openapi.IndexBuilder.processAnnotatedType(@Observes ProcessAnnotatedType<X>) receives events for all annotated types. Consider restricting events using @WithAnnotations or a generic type with bounds.
2021.03.15 19:02:17 INFO org.jboss.weld.Event !thread!: WELD-000411: Observer method [BackedAnnotatedMethod] public org.glassfish.jersey.ext.cdi1x.internal.ProcessAllAnnotatedTypes.processAnnotatedType(@Observes ProcessAnnotatedType<?>, BeanManager) receives events for all annotated types. Consider restricting events using @WithAnnotations or a generic type with bounds.
2021.03.15 19:02:19 INFO org.jboss.weld.Bootstrap !thread!: WELD-ENV-002003: Weld SE container 73cc4232-6051-4215-91a4-cd0be44226d8 initialized
2021.03.15 19:02:19 INFO io.helidon.microprofile.security.SecurityMpService !thread!: Security extension for microprofile is enabled, yet security configuration is missing from config (requires providers configuration at key security.providers). Security will not have any valid provider.
2021.03.15 19:02:22 INFO io.helidon.webserver.NettyWebServer !thread!: Version: 1.4.4
2021.03.15 19:02:22 INFO io.helidon.webserver.NettyWebServer !thread!: Channel '@default' started: [id: 0xfc765951, L:/[0:0:0:0:0:0:0:0]:8080]
2021.03.15 19:02:22 INFO io.helidon.microprofile.server.ServerImpl !thread!: Server initialized on http://localhost:8080 (and all other host addresses) in 9948 milliseconds.
2021.03.15 19:02:22 INFO org.books.bobby.Main !thread!: http://localhost:8080/books
2021.03.15 19:22:24 INFO org.books.bobby.BookStore !thread!: initializing caches
2021-03-15 19:22:25.628/1213.738 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Loaded operational configuration from "jar:file:/app/libs/coherence-20.12.jar!/tangosol-coherence.xml"
2021-03-15 19:22:25.680/1213.789 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Loaded operational overrides from "jar:file:/app/libs/coherence-20.12.jar!/tangosol-coherence-override-dev.xml"
2021-03-15 19:22:25.682/1213.790 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Optional configuration override "/tangosol-coherence-override.xml" is not specified
2021-03-15 19:22:25.685/1213.794 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Optional configuration override "cache-factory-config.xml" is not specified
2021-03-15 19:22:25.686/1213.794 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Optional configuration override "cache-factory-builder-config.xml" is not specified
2021-03-15 19:22:25.687/1213.795 Oracle Coherence 20.12 <Info> (thread=helidon-1, member=n/a): Optional configuration override "/custom-mbeans.xml" is not specified

Oracle Coherence Version 20.12 Build 83712
 Community Edition: Development mode
Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

2021-03-15 19:22:25.909/1214.017 Oracle Coherence CE 20.12 <Info> (thread=helidon-1, member=n/a): Loaded cache configuration from "jar:file:/app/bobbys-helidon-stock-application.jar!/coherence-cache-config.xml"
2021-03-15 19:22:26.354/1214.462 Oracle Coherence CE 20.12 <Info> (thread=helidon-1, member=n/a): The cluster name has not been configured, a value of "root's cluster" has been automatically generated
2021-03-15 19:22:26.408/1214.517 Oracle Coherence CE 20.12 <D5> (thread=helidon-1, member=n/a): Created cache factory com.tangosol.net.ExtensibleConfigurableCacheFactory
2021-03-15 19:22:26.565/1214.674 Oracle Coherence CE 20.12 <Info> (thread=bobbys-proxy-service:TcpInitiator, member=n/a): Loaded POF configuration from "jar:file:/app/bobbys-helidon-stock-application.jar!/pof-config.xml"
2021-03-15 19:22:26.602/1214.711 Oracle Coherence CE 20.12 <Info> (thread=bobbys-proxy-service:TcpInitiator, member=n/a): Loaded included POF configuration from "jar:file:/app/libs/coherence-20.12.jar!/coherence-pof-config.xml"
2021.03.15 19:22:32 INFO org.books.bobby.BookStore !thread!: Coherence is ready to be used
==== END logs for container bobbys-helidon-stock-application of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
==== START logs for container istio-proxy of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
2021-03-15T19:02:31.381531Z	info	FLAG: --concurrency="2"
2021-03-15T19:02:31.381581Z	info	FLAG: --disableInternalTelemetry="false"
2021-03-15T19:02:31.381591Z	info	FLAG: --domain="bobs-books.svc.cluster.local"
2021-03-15T19:02:31.381597Z	info	FLAG: --help="false"
2021-03-15T19:02:31.381603Z	info	FLAG: --id=""
2021-03-15T19:02:31.381609Z	info	FLAG: --ip=""
2021-03-15T19:02:31.381615Z	info	FLAG: --log_as_json="false"
2021-03-15T19:02:31.381620Z	info	FLAG: --log_caller=""
2021-03-15T19:02:31.381627Z	info	FLAG: --log_output_level="default:info"
2021-03-15T19:02:31.381634Z	info	FLAG: --log_rotate=""
2021-03-15T19:02:31.381640Z	info	FLAG: --log_rotate_max_age="30"
2021-03-15T19:02:31.381647Z	info	FLAG: --log_rotate_max_backups="1000"
2021-03-15T19:02:31.381653Z	info	FLAG: --log_rotate_max_size="104857600"
2021-03-15T19:02:31.381660Z	info	FLAG: --log_stacktrace_level="default:none"
2021-03-15T19:02:31.381671Z	info	FLAG: --log_target="[stdout]"
2021-03-15T19:02:31.381679Z	info	FLAG: --meshConfig="./etc/istio/config/mesh"
2021-03-15T19:02:31.381685Z	info	FLAG: --mixerIdentity=""
2021-03-15T19:02:31.381691Z	info	FLAG: --outlierLogPath=""
2021-03-15T19:02:31.381698Z	info	FLAG: --proxyComponentLogLevel="misc:error"
2021-03-15T19:02:31.381705Z	info	FLAG: --proxyLogLevel="warning"
2021-03-15T19:02:31.381711Z	info	FLAG: --serviceCluster="bobbys-helidon-stock-application.bobs-books"
2021-03-15T19:02:31.381717Z	info	FLAG: --serviceregistry="Kubernetes"
2021-03-15T19:02:31.381722Z	info	FLAG: --stsPort="0"
2021-03-15T19:02:31.381728Z	info	FLAG: --templateFile=""
2021-03-15T19:02:31.381733Z	info	FLAG: --tokenManagerPlugin="GoogleTokenExchange"
2021-03-15T19:02:31.381739Z	info	FLAG: --trust-domain="cluster.local"
2021-03-15T19:02:31.381779Z	info	Version 1.7.3-16752a61bc5f95e8fa8c1e439d2c7271c54fa5a1-dirty-Modified
2021-03-15T19:02:31.382017Z	info	Obtained private IP [REDACTED-FOR-TEST REDACTED-FOR-TEST]
2021-03-15T19:02:31.382125Z	info	Apply proxy config from env {"proxyMetadata":{"DNS_AGENT":""}}

2021-03-15T19:02:31.383678Z	info	Effective config: binaryPath: /usr/local/bin/envoy
concurrency: 2
configPath: ./etc/istio/proxy
controlPlaneAuthPolicy: MUTUAL_TLS
discoveryAddress: istiod.istio-system.svc:15012
drainDuration: 45s
envoyAccessLogService: {}
envoyMetricsService: {}
parentShutdownDuration: 60s
proxyAdminPort: 15000
proxyMetadata:
  DNS_AGENT: ""
serviceCluster: bobbys-helidon-stock-application.bobs-books
statNameLength: 189
statusPort: 15020
terminationDrainDuration: 5s
tracing:
  zipkin:
    address: zipkin.istio-system:9411

2021-03-15T19:02:31.383742Z	info	Proxy role: &model.Proxy{Type:"sidecar", IPAddresses:[]string{"REDACTED-FOR-TEST", "REDACTED-FOR-TEST"}, ID:"bobbys-helidon-stock-application-7965cf98f5-kfdmx.bobs-books", Locality:(*envoy_config_core_v3.Locality)(nil), DNSDomain:"bobs-books.svc.cluster.local", ConfigNamespace:"", Metadata:(*model.NodeMetadata)(nil), SidecarScope:(*model.SidecarScope)(nil), PrevSidecarScope:(*model.SidecarScope)(nil), MergedGateway:(*model.MergedGateway)(nil), ServiceInstances:[]*model.ServiceInstance(nil), IstioVersion:(*model.IstioVersion)(nil), ipv6Support:false, ipv4Support:false, GlobalUnicastIP:"", XdsResourceGenerator:model.XdsResourceGenerator(nil), Active:map[string]*model.WatchedResource(nil), ActiveExperimental:map[string]*model.WatchedResource(nil), RequestedTypes:struct { CDS string; EDS string; RDS string; LDS string }{CDS:"", EDS:"", RDS:"", LDS:""}}
2021-03-15T19:02:31.383749Z	info	JWT policy is third-party-jwt
2021-03-15T19:02:31.383798Z	info	PilotSAN []string{"istiod.istio-system.svc"}
2021-03-15T19:02:31.383806Z	info	MixerSAN []string{"spiffe://cluster.local/ns/istio-system/sa/istio-mixer-service-account"}
2021-03-15T19:02:31.383893Z	info	sa.serverOptions.CAEndpoint == istiod.istio-system.svc:15012
2021-03-15T19:02:31.383899Z	info	Using user-configured CA istiod.istio-system.svc:15012
2021-03-15T19:02:31.383904Z	info	istiod uses self-issued certificate
2021-03-15T19:02:31.384015Z	info	the CA cert of istiod is: -----BEGIN CERTIFICATE-----
REDACTED-FOR-TEST
-----END CERTIFICATE-----

2021-03-15T19:02:31.444720Z	info	sds	SDS gRPC server for workload UDS starts, listening on "./etc/istio/proxy/SDS"

2021-03-15T19:02:31.444909Z	info	Starting proxy agent
2021-03-15T19:02:31.444802Z	info	sds	Start SDS grpc server
2021-03-15T19:02:31.445000Z	info	Opening status port 15020

2021-03-15T19:02:31.445090Z	info	Received new config, creating new Envoy epoch 0
2021-03-15T19:02:31.445105Z	info	Epoch 0 starting
2021-03-15T19:02:31.452370Z	info	Envoy command: [-c etc/istio/proxy/envoy-rev0.json --restart-epoch 0 --drain-time-s 45 --parent-shutdown-time-s 60 --service-cluster bobbys-helidon-stock-application.bobs-books --service-node sidecar~REDACTED-FOR-TEST~bobbys-helidon-stock-application-7965cf98f5-kfdmx.bobs-books~bobs-books.svc.cluster.local --local-address-ip-version v4 --log-format-prefix-with-location 0 --log-format %Y-%m-%dT%T.%fZ	%l	envoy %n	%v -l warning --component-log-level misc:error --concurrency 2]
2021-03-15T19:02:32.244942Z	warning	envoy runtime	Unable to use runtime singleton for feature envoy.reloadable_features.activate_fds_next_event_loop
2021-03-15T19:02:32.710317Z	warning	envoy config	StreamAggregatedResources gRPC config stream closed: 14, no healthy upstream
2021-03-15T19:02:32.710405Z	warning	envoy config	Unable to establish new stream
2021-03-15T19:02:32.832032Z	info	sds	resource:default new connection
2021-03-15T19:02:32.832168Z	info	sds	Skipping waiting for gateway secret
2021-03-15T19:02:33.455910Z	info	cache	Root cert has changed, start rotating root cert for SDS clients
2021-03-15T19:02:33.455987Z	info	cache	GenerateSecret default
2021-03-15T19:02:33.457454Z	info	sds	resource:default pushed key/cert pair to proxy
2021-03-15T19:02:33.483672Z	warning	envoy main	there is no configured limit to the number of allowed active connections. Set a limit via the runtime key overload.global_downstream_max_connections
2021-03-15T19:02:34.613291Z	info	sds	resource:ROOTCA new connection
2021-03-15T19:02:34.613400Z	info	sds	Skipping waiting for gateway secret
2021-03-15T19:02:34.613433Z	info	cache	Loaded root cert from certificate ROOTCA
2021-03-15T19:02:34.613646Z	info	sds	resource:ROOTCA pushed root cert to proxy
2021-03-15T19:02:40.527404Z	info	Envoy proxy is ready
2021-03-15T19:30:38.012375Z	warning	envoy config	StreamAggregatedResources gRPC config stream closed: 13,
==== END logs for container istio-proxy of pod bobs-books/bobbys-helidon-stock-application-7965cf98f5-kfdmx ====
